---
title: 前端工程化实践
date: 2017-08-18 00:00
tags: [全栈,Node,草稿]
---

# DTU前端工程化实践

## 采用组件化的方式快速迭代产品

前端组件是页面上可复用的UI单元，比如信息区块、页头、页尾、导航等。
快速设计页面路由，整个产品包含哪些“栏目”，快速完成架构搭建。
在工程正式开发之前，我们仔细研究了设计图，统计出整个产品包含哪些组件，哪些组件可复用程度更高。
优先开发复用度高的组件，完成后快速拼装出产品页面。最后完成个性的组件等。
前端开发的效率会依赖设计稿的完整度，设计师提供的设计稿越完整，前端工程师的开发效率会越高。

(图片制作： 页面A --- 组件A --- 页面B)

## git规范化
### 规范化git工作流
高效的开发团队，需要规范化的代码管理流程做保证，直接沿用了成熟的开发流程。
每日集成的开发策略，在产品开发阶段，每位工程师在自己的开发分支下快速开发，每天下午定时，由组长将代码集成到daily分支。在集成的过程中，进行CodeReview，检查代码规范和逻辑的部分。集成后执行Jenkins的构建过程。

产品上线后，进入快速迭代阶段，工程师的开发分支转换为功能分支。
每天完成计划中功能的部分，集成到daily分支。

每天的目标明确，成果可见，每天都很有成就感。

（图片：git工作流图）

### git提交规范
怎样评价一次好的代码提交。一次代码提交应该做到原子性，一次提交完成一个bug的修改，一个功能的文档，一次重构等。好的代码提交说明，应该完全匹配修改的内容。提交说明，最好能够包含对修改的部分、类型给出明确的说明。


（gitlab截图：）

> fix(service):服务编辑时没有去掉可见性字段校验

团队直接引入了广泛使用的Angular提交规范，比较合理和系统化，并且有配套的工具。

（工具图片）
```
1、feat：新功能（feature）
2、fix：修补bug
3、docs：文档（documentation）
4、style： 格式（不影响代码运行的变动）
5、refactor：重构（即不是新增功能，也不是修改bug的代码变动）
6、test：增加测试
7、chore：构建过程或辅助工具的变动
```
格式化的Commit message，有几个好处。

1、提供更多的历史信息，方便代码CodeReview。
2、可以过滤commit，快速查找信息。
3、还可以由提交说明生成产品的changelog。
（Jenkins截图）

## 代码规范化
组建一直规范化的前端团队，是我转型技术管理的理想，目标很简单：保证产品代码完全是由一个人写的，代码和注释风格的统一。

### JavaScript的语言升级和规范化
循序渐进的由ES5升级到ES6，比如禁止使用var声明变量，使用let或const替换。
对于函数的声明，鼓励去掉function关键字和更多的使用箭头函数，使用函数的默认值；
用模版字符串替换掉之前的字符串拼接；

逐渐深入使用ES6的更多的特性。
引入Airbnb的语言规范，并使用eslint在编辑阶段和“编译”阶段检查代码的风格是否符合规范。对不符合规范的代码，会给出错误提示，并不能执行代码。

大家在学习Airbnb的规范的同时，对照ES5和ES6的写法，快速完成语言的切换。

下面的代码，实现数据的复制，可以发现ES6代码会更简洁高效。

```javascript
// bad
const len = items.length;
const itemsCopy = [];
let i;

for (i = 0; i < len; i += 1) {
  itemsCopy[i] = items[i];
}

// good
const itemsCopy = [...items];
```

### CSS预处理器SASS
样式预处理器SASS，为CSS带来了编程语言的能力，比如变量、函数和模块化。使用SASS能够很大程度上提高代码的复用度。

JavaScript有eslint检查工具，对于SASS可以使用stylelint检查代码，

遗憾的是社区开源的编辑器插件不是很完善，只找到了atom版本。

### HTMl的规范化
技术架构统一为Vue2.x，很遗憾没有找到Vue中HTML的规范化工具，后期会进行引入或研究开源。

## 从组件化到模块化，从引用开源到开源贡献
Vue的组件化能力，极大的缩短了产品开发周期，但回顾过去产品间的代码复用是不够的。
每个产品都有自己的time-format，重复劳动太多，不仅仅需要组件化，我们需要模块化！
各个产品引入了iView，减少了很多重复的劳动，为大家竖立了榜样。
希望团队成员都适度参与到开源社区的贡献，大家都是前端生态的一部分。

不止于业务，向前一步。在完成功能开发后，多一些思考，想一下开发的功能其他开发者是不是有可能会用到。

从制度到习惯。

## 源代码即文档
设计了声明式的model层，从代码中直观的看到接口协议，地址和参数规则等。
```
// define api
export const addInternalGroup = schema.post('/path/to/action', {
  name: { type: String, required: true },
  info: { type: String, required: true },
});

// use api
addInternalGroup({ name: 'xxx', info: 'xxx' }).then((json) => {
  log(json);  
});
```
开源了apischema https://www.npmjs.com/package/apischema

## 从前端到大前端

工程师要竖立前端大局观，从不同的角度考虑技术方案。

用前端的方案实现产品的灰度分流和配置。

基于koa2开源企业级Node解决方案Flclover，目前稳定在0.7.x版本，已经在内部两个项目完成了验证。

后期会优先在分析线落地。

## 最后
在前端工程化方面还有很长的路要走，持续学习和进步。

加油2017！
